# IOT_SPWM

#### 介绍

基于STM32F103C8T6实现的SPWM单相逆变电源，包括原理图、PCB以及程序代码；

SPWM的核心是正弦表。需要在代码中生成一个正弦表，存储正弦波的幅值数据。可以通过数学公式计算正弦值并存储到数组中。本设计中PWM的信号频率为2KHz，当SPWM输出的调制信号为50Hz时，一个正弦信号的半个周期被分为20个区间，每一个区间的PWM信号的占空比通过三角波与正弦函数的比较得到，通过等效面积法进行比较，即将标准正弦信号通过N点采样之后，计算一个区间内的正弦信号采样点数，对这些采样值进行累加，再根据SPWM的调制深度，得到占空比。具体步骤为：

（1）在上位机通过EXCEL计算得到采样点数为2048个点，幅度为65535的半个周期的正弦数值表，存储为C语言的数组。如图4-1所示。

（2）将正弦数值表，在主循环中每隔一段时间根据当前SPWM信号的幅度通过等效面积法计算每一个区间内的PWM信号的占空比，得到20个区间的PWM占空比的数组。

（3）当定时器的更新中断时，通过计数指针判断当前应该输出哪一个PWM区间的占空比，并从主循环程序中计算得到的占空比数组中读中对应的占空比数值，写入TIM1_CH1和TIM1_CH2的占空比CCR寄存器，其中取TIM1_CH2时通过索引偏移达到移相180°的效果。

#### 硬件设计

驱动隔离模块采用光耦合器TLP250和IR2110S驱动器，实现信号隔离与放大，保护控制电路并精确控制功率开关器件。输出电压检测模块通过滤波、放大和钳位处理，将微弱信号调理为适合ADC输入的电压信号。用户交互模块包括LED指示、OLED显示、按键输入和电机驱动功能，提供直观操作界面。电压稳压模块利用LM7133-1稳压器，为系统提供稳定的3.3V电源。核心模块基于STM32F103C8T6微控制器，提供稳定运行环境和丰富接口，实现SPWM调制波输出与模拟信号采集。各模块协同工作，确保逆变电路的高效、稳定运行。

#### 

#### 使用说明

1. 本设计包含LED指示模块、OLED显示模块、按键输入模块和升压变压器驱动模块等部分。
   LED模块设计：当LED的正极通过电阻R29连接到电源VCC，负极连接到GND时，电流流过LED使其发光。电阻R29用于限制流过LED的电流，防止LED因过流而损坏，LED用作状态指示，指示电路SPWM是否输出，当控制器处于空闲状态，SPWM电源不输出时，LED以1Hz的频率慢闪；当控制器处于工作状态，SPWM电源输出时，LED以10Hz的频率快闪；
   OLED显示模块：OLED显示屏UN-2864KMBEG01，连接到VCC、GND、SCL、SDA。OLED显示屏通过I2C接口（由SCL和SDA线组成）与处理器通信。VCC和GND为显示屏供电，OLED显示屏实时显示当前工作状态、SPWM调试深度(0-9999)，以及检测到的变压器输出电压值(0-100V)。
   按键输入模块：按键开关SW1连接GND和KEY1，当按键被按下时，KEY1引脚被拉到地电平，微控制器可以检测到这个变化，通过按键输入可以启动或者停止SPWM电源的输出；

#### 联系作者

VX:1076279743
